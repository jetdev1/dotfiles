require('bufferline').setup{
    auto_hide = true,
    icon_separator_active = ' ',
    icon_separator_inactive = ' ',
    icon_close_tab = '',
    icon_close_tab_modified = '●',
    icon_pinned = '車',

    highlights = {
        fill = {
            guibg = { attribute = 'bg', highlight = 'Normal' }
        },
        background = {
            guibg = { attribute = 'bg', highlight = '' }
        },
        buffer = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        buffer_visible = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        buffer_selected = {
            guifg = { attribute = 'fg', highlight = 'Normal' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
            gui = false,
        },
        modified = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'NonText' },
        },
        modified_visible = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'NonText' },
        },
        modified_selected = {
            guifg = { attribute = 'fg', highlight = 'Normal' },
            gui = false,
        },
        duplicate = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'NonText' },
            gui = 'bold',
        },
        duplicate_visible = {
            guibg = { attribute = 'bg', highlight = 'Normal' },
            gui = 'bold',
        },
        duplicate_selected = {
            guifg = { attribute = 'fg', highlight = 'Normal' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
            gui = 'bold',
        },
        diagnostic = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        diagnostic_visible = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        diagnostic_selected = {
            guifg = { attribute = 'fg', highlight = 'Normal' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
            gui = false,
        },
        error = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        error_visible = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        error_selected = {
            guifg = { attribute = 'fg', highlight = 'Normal' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
            gui = false,
        },
        error_diagnostic = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        error_diagnostic_visible = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        error_diagnostic_selected = {
            guifg = { attribute = 'fg', highlight = 'Normal' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
            gui = false,
        },
        warning = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        warning_visible = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        warning_selected = {
            guifg = { attribute = 'fg', highlight = 'Normal' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
            gui = false,
        },
        warning_diagnostic = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        warning_diagnostic_visible = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        warning_diagnostic_selected = {
            guifg = { attribute = 'fg', highlight = 'Normal' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
            gui = false,
        },
        info = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        info_visible = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        info_selected = {
            guifg = { attribute = 'fg', highlight = 'Normal' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
            gui = false,
        },
        info_diagnostic = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        info_diagnostic_visible = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        info_diagnostic_selected = {
            guifg = { attribute = 'fg', highlight = 'Normal' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
            gui = false,
        },
        hint = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        hint_visible = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        hint_selected = {
            guifg = { attribute = 'fg', highlight = 'Normal' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
            gui = false
        },
        hint_diagnostic = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        hint_diagnostic_visible = {
            guifg = { attribute = 'fg', highlight = 'NonText' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
        },
        hint_diagnostic_selected = {
            guifg = { attribute = 'fg', highlight = 'Normal' },
            guibg = { attribute = 'bg', highlight = 'Normal' },
            gui = false,
        },
    }
}

local nvim_tree_events = require('nvim-tree.events')
local bufferline_state = require('bufferline.state')

local function get_tree_size()
  return require'nvim-tree.view'.View.width
end

nvim_tree_events.subscribe('TreeOpen', function()
  bufferline_state.set_offset(get_tree_size())
end)

nvim_tree_events.subscribe('Resize', function()
  bufferline_state.set_offset(get_tree_size())
end)

nvim_tree_events.subscribe('TreeClose', function()
  bufferline_state.set_offset(0)
end)
